
# 🚀  DoH پیشرفته با پنل مدیریت کانفیگ V2Ray

یک سرویس‌دهنده (Worker) قدرتمند و امن برای Cloudflare که درخواست‌های DNS شما را رمزنگاری کرده و با یک پنل مدیریت زیبا و کاربردی، امکان تولید کانفیگ‌های مختلف برای کلاینت‌های V2Ray را فراهم می‌کند.

<div align="center">

[![تعداد ستاره‌ها](https://img.shields.io/github/stars/sinaha81/dns?style=for-the-badge&logo=github)](https://github.com/sinaha81/dns/stargazers)
[![فورک‌ها](https://img.shields.io/github/forks/sinaha81/dns?style=for-the-badge&logo=github)](https://github.com/sinaha81/dns/network/members)
[![پلتفرم](https://img.shields.io/badge/Platform-Cloudflare%20Workers-orange?style=for-the-badge&logo=cloudflare)](https://workers.cloudflare.com/)

</div>

## 📖 توضیحات

این پروژه یک پروکسی DoH (DNS over HTTPS) است که بر روی زیرساخت بدون سرور (Serverless) کلادفلر اجرا می‌شود. این سرویس نه تنها درخواست‌های DNS شما را برای افزایش حریم خصوصی و امنیت رمزنگاری می‌کند، بلکه یک **پنل مدیریت تحت وب** در اختیار شما قرار می‌دهد که به صورت خودکار کانفیگ‌های پیشرفته و بهینه برای کلاینت‌های V2Ray (مانند v2rayNG و Nekoray) تولید می‌کند. این پنل به شما اجازه می‌دهد تا پارامترهای مختلف مانند **Server Name**، **ALPN** و **TLS Fingerprint** را به صورت پویا تنظیم کرده و کانفیگ‌های مختلف (با و بدون Fragment) را به راحتی کپی و استفاده کنید.

## ✨ ویژگی‌ها

-   🔐 **رمزنگاری کامل DNS**: تمامی درخواست‌های DNS شما از طریق HTTPS رمزنگاری شده و از شنود (sniffing) در امان می‌مانند.
-   ⚡ **انتخاب هوشمند DNS سرور**: به صورت هوشمند و بر اساس وزن‌دهی، یکی از بهترین سرویس‌دهندگان DNS عمومی (مانند Cloudflare, Google, Quad9) را برای پاسخگویی انتخاب می‌کند.
-   ⚙️ **پنل مدیریت پیشرفته تحت وب**:
    -   تولید آنی سه نوع کانفیگ V2Ray: **Fix Fragment**, **Best Fragment** (پیشرفته) و **No Fragment**.
    -   قابلیت تنظیم پارامترهای کلیدی مانند **Server Name (SNI)**، **ALPN** و **TLS Fingerprint** به صورت پویا.
    -   رابط کاربری زیبا و کاربرپسند با الهام از طراحی GitHub.
    -   کپی کردن آسان آدرس سرویس و کانفیگ‌ها تنها با یک کلیک.
-   🛡️ **امنیت بالا**:
    -   **Rate Limiting**: محدود کردن تعداد درخواست‌ها برای جلوگیری از حملات (۱۰۰ درخواست در هر دقیقه).
    -   **هدرهای امنیتی**: استفاده از هدرهای امنیتی استاندارد مانند `Strict-Transport-Security` و `Content-Security-Policy`.
    -   **Fallback خودکار**: در صورت عدم پاسخگویی یک سرور DNS، به صورت خودکار سراغ سرور بعدی می‌رود.
-   🚀 **استقرار آسان و رایگان**: به راحتی و در کمتر از چند دقیقه بر روی پلن رایگان Cloudflare Workers قابل پیاده‌سازی است.

## 🚀 نصب و راه‌اندازی سریع

### مرحله ۱: ایجاد یک Worker در Cloudflare

1.  به داشبورد [Cloudflare](https://dash.cloudflare.com) وارد شوید.
2.  از منوی سمت چپ، به بخش **Workers & Pages** بروید.
3.  روی **Create Application** و سپس **Create Worker** کلیک کنید.
4.  یک نام منحصر به فرد برای Worker خود انتخاب کنید (برای مثال: `my-doh-proxy`).
5.  روی دکمه **Deploy** کلیک کنید.

### مرحله ۲: قرار دادن کد در Worker

1.  پس از ساخت Worker، روی دکمه **Edit code** کلیک کنید.
2.  تمام کدهای موجود در ویرایشگر را پاک کنید.
3.  محتوای [این فایل](https://github.com/sinaha81/dns/blob/main/worker.js) را به طور کامل کپی کرده و در ویرایشگر جای‌گذاری کنید.
4.  در نهایت، روی **Save and Deploy** کلیک کنید.

### مرحله ۳: استفاده از پنل مدیریت

اکنون سرویس شما آماده است. با مراجعه به آدرس Worker خود، پنل مدیریت را مشاهده خواهید کرد:
`https://my-doh-proxy.your-subdomain.workers.dev`

## 📱 نحوه استفاده

### ۱. کلاینت‌های V2Ray (پیشنهادی)

پس از راه‌اندازی، به آدرس اصلی Worker خود بروید تا پنل مدیریت را ببینید. در این پنل می‌توانید:

-   **پارامترهای عمومی را تنظیم کنید**:
    -   **لیست Server Name**: دامنه‌های مورد نظر خود را برای استفاده در SNI وارد کنید.
    -   **ALPN**: پروتکل لایه برنامه مورد نظر را انتخاب کنید.
    -   **TLS Fingerprint**: اثر انگشت TLS را برای شبیه‌سازی ترافیک مرورگرهای مختلف تنظیم کنید.
-   **کانفیگ مورد نظر را کپی کنید**:
    -   **Fix Fragment**: یک کانفیگ استاندارد با تنظیمات Fragment ثابت.
    -   **Best Fragment (پیشرفته)**: به صورت خودکار بهترین حالت Fragment را انتخاب می‌کند.
    -   **No Fragment**: برای شبکه‌هایی که نیازی به تکه‌تکه کردن بسته‌ها ندارند.

کانفیگ کپی شده را مستقیماً در کلاینت V2Ray خود (مانند v2rayNG) از طریق گزینه **Import config from Clipboard** وارد کنید.

### ۲. سایر دستگاه‌ها و برنامه‌ها

آدرس DoH خود را از پنل مدیریت کپی کنید. فرمت آن به شکل زیر است:
```
https://your-worker-name.your-subdomain.workers.dev/dns-query
```
سپس از این آدرس در برنامه‌های زیر استفاده کنید:

#### مرورگر Chrome / Edge / Brave
```
Settings → Privacy and security → Security → Use secure DNS → Custom
```

#### مرورگر Firefox
```
Settings → Privacy & Security → DNS over HTTPS → Custom
```

#### اپلیکیشن Intra (اندروید)
1.  اپلیکیشن [Intra](https://play.google.com/store/apps/details?id=app.intra) را نصب و باز کنید.
2.  از منوی بالا سمت چپ، وارد **Settings** شوید.
3.  گزینه **Select DNS over HTTPS Server** را انتخاب کنید.
4.  **Custom server URL** را انتخاب کرده و آدرس DoH خود را وارد کنید.
5.  به صفحه اصلی برگشته و سرویس را فعال کنید.

## 🌐 سرورهای DNS استفاده شده

این پروکسی به صورت پیش‌فرض از مجموعه‌ای از بهترین و سریع‌ترین سرویس‌دهندگان DNS عمومی استفاده می‌کند:

| نام سرویس    | دسته‌بندی            | توضیحات                                                    |
| :----------- | :-------------------- | :--------------------------------------------------------- |
| **Cloudflare** | عمومی و سریع          | تمرکز بر سرعت و حریم خصوصی، بدون ذخیره لاگ.                |
| **Google**     | عمومی و سریع          | پایداری و سرعت بالا در سراسر جهان.                         |
| **Quad9**      | عمومی و سریع          | مسدودسازی دامنه‌های مخرب، فیشینگ و بدافزارها.              |
| **OpenDNS**    | عمومی و سریع          | یکی از قدیمی‌ترین و پایدارترین سرویس‌های DNS.              |
| **DNS4EU**     | عمومی و سریع          | سرویس DNS اروپایی با تمرکز بر حریم خصوصی.                  |
| **AdGuard**    | مسدودکننده تبلیغات   | مسدودسازی موثر تبلیغات، ردیاب‌ها و سایت‌های مخرب.         |

## ⚠️ نکات مهم

-   این سرویس **فقط درخواست‌های DNS** را رمزنگاری می‌کند و یک vpn نیست .

## 🤝 مشارکت

از هرگونه مشارکت در این پروژه استقبال می‌شود. اگر پیشنهاد یا مشکلی دارید، لطفاً یک **Issue** جدید ثبت کنید یا یک **Pull Request** ارسال نمایید.

---

<p align="center">
  ⭐ اگر این پروژه برای شما مفید بود، لطفاً با ستاره دادن به آن از ما حمایت کنید! ⭐
</p>
